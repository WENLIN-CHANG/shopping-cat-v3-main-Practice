# Alpine.js 購物車學習筆記

## 專案概述
這是一個使用 Alpine.js 實現的貓咪認養購物車系統，具備完整的 CRUD 功能和數據持久化。

## 核心學習重點

### 1. Alpine.js 基礎概念

#### 狀態管理
```javascript
const functionControl = () => {
  return {
    // 數據狀態
    cart: [],                    // 購物車陣列
    cats: catsData.cats,        // 貓咪資料陣列
    
    // 方法
    addCart(catId) { ... }
  }
}
```

#### HTML 綁定語法
- `x-data="functionControl"` - 綁定數據控制器
- `@click="method()"` - 點擊事件綁定
- `x-text="variable"` - 文字內容綁定
- `x-model.number="item.quantity"` - 雙向數據綁定
- `x-for="item in array"` - 列表循環渲染
- `x-bind:key="item.id"` - 循環項目唯一鍵值

### 2. 購物車功能實現

#### 加入購物車
```javascript
addCart(catId) {
  const cat = this.cats.find(c => c.id === catId);
  if (!cat) return;
  
  const existingItem = this.cart.find(item => item.id === catId);
  if (existingItem) {
    existingItem.quantity += 1;  // 已存在，數量+1
  } else {
    this.cart.push({             // 新項目，加入陣列
      id: cat.id,
      name: cat.name,
      price: cat.price,
      quantity: 1
    });
  }
  this.saveCart();  // 保存到 localStorage
}
```

#### 刪除購物車項目
```javascript
removeFromCart(catId) {
  const index = this.cart.findIndex(item => item.id === catId);
  if (index !== -1) {           // 注意：不能用 if(index)，因為索引0會是false
    this.cart.splice(index, 1);
  }
  this.saveCart();
}
```

#### 清空購物車
```javascript
clearCart() {
  if (confirm('確定要清空所有認養清單嗎？')) {
    this.cart = [];             // 重設為空陣列
  }
  this.saveCart();
}
```

#### 計算總價
```javascript
totalPrice() {
  let total = 0;
  for (let item of this.cart) {        // 使用 of 遍歷值，in 遍歷索引
    total = total + (item.price * item.quantity);
  }
  return total.toFixed(2);             // 格式化為兩位小數
}
```

### 3. JavaScript 重要概念

#### let vs const
- `let` - 可變變數，值可以重新賦值
- `const` - 常數，值不能改變

#### for...of vs for...in
```javascript
// for...of - 遍歷值（內容）
for (let item of array) {
  console.log(item);        // 直接得到元素
}

// for...in - 遍歷索引（位置）  
for (let index in array) {
  console.log(index);       // 得到索引
  console.log(array[index]); // 需要用索引取值
}
```

#### 陣列方法
- `find()` - 找到符合條件的第一個元素
- `findIndex()` - 找到符合條件的第一個元素索引
- `splice(index, 1)` - 從索引位置刪除1個元素
- `push()` - 在陣列末尾加入元素

#### 重要陷阱
```javascript
// 錯誤：索引0會被當作false
if (index) { ... }

// 正確：明確檢查不等於-1  
if (index !== -1) { ... }
```

### 4. localStorage 數據持久化

#### 基本概念
- localStorage 只能存字串，不能直接存物件
- 使用 `JSON.stringify()` 將物件轉字串
- 使用 `JSON.parse()` 將字串轉回物件

#### 實現方式
```javascript
// 初始化時讀取
cart: JSON.parse(localStorage.getItem('shoppingCart')) || [],

// 保存數據
saveCart() {
  localStorage.setItem('shoppingCart', JSON.stringify(this.cart));
}
```

#### 邏輯或運算子
```javascript
JSON.parse(localStorage.getItem('key')) || []
// 左邊有值：使用解析後的數據
// 左邊是null：使用右邊的空陣列
```

### 5. HTML 模板循環

#### 動態列表渲染
```html
<tbody>
  <template x-for="item in cart" x-bind:key="item.id">
    <tr>
      <td x-text="item.name"></td>
      <td>
        <input x-model.number="item.quantity" type="number" min="1">
      </td>
      <td x-text="'$' + item.price"></td>
      <td x-text="'$' + (item.price * item.quantity).toFixed(2)"></td>
      <td>
        <button @click="removeFromCart(item.id)">刪除</button>
      </td>
    </tr>
  </template>
</tbody>
```

### 6. 數據流向

1. 點擊認養 → addCart() → 更新 cart 陣列 → saveCart() → localStorage
2. 修改數量 → x-model 雙向綁定 → 自動更新 cart 陣列和UI
3. 計算總價 → totalPrice() → 遍歷 cart 陣列 → 返回格式化金額
4. 頁面刷新 → 從 localStorage 讀取 → 恢復 cart 狀態

## 完整功能清單

- 點擊認養加入購物車
- 動態顯示認養清單
- 數量雙向綁定修改
- 自動計算小計和總價
- 刪除單個項目
- 清空整個購物車（含確認對話框）
- localStorage 持久化存儲

## 重要心得

1. Alpine.js 的核心是響應式 - 狀態改變時UI自動更新
2. 陣列索引檢查很重要 - 索引0不等於false
3. localStorage 需要序列化 - 物件必須轉成字串存儲
4. 雙向綁定很強大 - x-model 讓數據同步變得簡單
