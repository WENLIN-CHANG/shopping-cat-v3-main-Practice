# Alpine.js 購物車學習筆記

## 專案概述
這是一個使用 Alpine.js 實現的貓咪認養購物車系統，具備完整的 CRUD 功能和數據持久化。

## 核心學習重點

### 1. Alpine.js 基礎概念

#### 狀態管理
```javascript
const functionControl = () => {
  return {
    // 數據狀態
    cart: [],                    // 購物車陣列
    cats: catsData.cats,        // 貓咪資料陣列
    
    // 方法
    addCart(catId) { ... }
  }
}
```

#### HTML 綁定語法
- `x-data="functionControl"` - 綁定數據控制器
- `@click="method()"` - 點擊事件綁定
- `@input="method()"` - 輸入事件綁定（即時觸發）
- `@change="method()"` - 變更事件綁定（失焦觸發）
- `x-text="variable"` - 文字內容綁定
- `x-model.number="item.quantity"` - 雙向數據綁定
- `x-for="item in array"` - 列表循環渲染
- `x-bind:key="item.id"` - 循環項目唯一鍵值
- `:src="path"` - 動態屬性綁定（等同於 x-bind:src）

### 2. 購物車功能實現

#### 加入購物車
```javascript
addCart(catId) {
  const cat = this.cats.find(c => c.id === catId);
  if (!cat) return;
  
  const existingItem = this.cart.find(item => item.id === catId);
  if (existingItem) {
    existingItem.quantity += 1;  // 已存在，數量+1
  } else {
    this.cart.push({             // 新項目，加入陣列
      id: cat.id,
      name: cat.name,
      price: cat.price,
      quantity: 1
    });
  }
  this.saveCart();  // 保存到 localStorage
}
```

#### 刪除購物車項目
```javascript
removeFromCart(catId) {
  const index = this.cart.findIndex(item => item.id === catId);
  if (index !== -1) {           // 注意：不能用 if(index)，因為索引0會是false
    this.cart.splice(index, 1);
  }
  this.saveCart();
}
```

#### 清空購物車
```javascript
clearCart() {
  if (confirm('確定要清空所有認養清單嗎？')) {
    this.cart = [];             // 重設為空陣列
  }
  this.saveCart();
}
```

#### 計算總價
```javascript
totalPrice() {
  let total = 0;
  for (let item of this.cart) {        // 使用 of 遍歷值，in 遍歷索引
    total = total + (item.price * item.quantity);
  }
  return total.toFixed(2);             // 格式化為兩位小數
}
```

#### 數量輸入驗證
```javascript
validateQuantity(item) {
  if (item.quantity < 1 || isNaN(item.quantity) || item.quantity == null) {
    item.quantity = 1;              // 自動修正為1
  }
  item.quantity = Math.floor(item.quantity);  // 轉為整數
  this.saveCart();                  // 保存變更
}
```

**驗證邏輯說明：**
- `item.quantity < 1` - 檢查負數和0
- `isNaN(item.quantity)` - 檢查非數字輸入（NaN = "Not a Number"）
- `item.quantity == null` - 檢查空值
- `Math.floor()` - 去除小數點，確保為整數

### 3. JavaScript 重要概念

#### let vs const
- `let` - 可變變數，值可以重新賦值
- `const` - 常數，值不能改變

#### for...of vs for...in
```javascript
// for...of - 遍歷值（內容）
for (let item of array) {
  console.log(item);        // 直接得到元素
}

// for...in - 遍歷索引（位置）  
for (let index in array) {
  console.log(index);       // 得到索引
  console.log(array[index]); // 需要用索引取值
}
```

#### 陣列方法
- `find()` - 找到符合條件的第一個元素
- `findIndex()` - 找到符合條件的第一個元素索引
- `splice(index, 1)` - 從索引位置刪除1個元素
- `push()` - 在陣列末尾加入元素

#### 重要陷阱
```javascript
// 錯誤：索引0會被當作false
if (index) { ... }

// 正確：明確檢查不等於-1  
if (index !== -1) { ... }
```

#### NaN（Not a Number）概念
```javascript
// 產生 NaN 的情況
Number('abc');     // NaN（無法轉換的文字）
parseInt('hello'); // NaN（解析失敗）
0 / 0;            // NaN（無效運算）

// isNaN() 檢查是否為 NaN
isNaN(123);       // false（是數字）
isNaN('abc');     // true（不是數字）  
isNaN(NaN);       // true（本身是NaN）
isNaN('');        // false（空字串轉成0）
```

### 4. localStorage 數據持久化

#### 基本概念
- localStorage 只能存字串，不能直接存物件
- 使用 `JSON.stringify()` 將物件轉字串
- 使用 `JSON.parse()` 將字串轉回物件

#### 實現方式
```javascript
// 初始化時讀取
cart: JSON.parse(localStorage.getItem('shoppingCart')) || [],

// 保存數據
saveCart() {
  localStorage.setItem('shoppingCart', JSON.stringify(this.cart));
}
```

#### 邏輯或運算子
```javascript
JSON.parse(localStorage.getItem('key')) || []
// 左邊有值：使用解析後的數據
// 左邊是null：使用右邊的空陣列
```

### 5. HTML 模板循環

#### 動態列表渲染
```html
<tbody>
  <template x-for="item in cart" x-bind:key="item.id">
    <tr>
      <td x-text="item.name"></td>
      <td>
        <input 
          x-model.number="item.quantity" 
          @input="validateQuantity(item)"
          type="number" 
          min="1"
        />
      </td>
      <td x-text="'$' + item.price"></td>
      <td x-text="'$' + (item.price * item.quantity).toFixed(2)"></td>
      <td>
        <button @click="removeFromCart(item.id)">刪除</button>
      </td>
    </tr>
  </template>
</tbody>
```

#### 動態貓咪卡片模板
```html
<template x-for="cat in cats" x-bind:key="cat.id">
  <div class="shadow card bg-base-100">
    <figure>
      <img :src="'/images/' + cat.picture" class="select-none" alt="" />
    </figure>
    <div class="card-body">
      <h5 class="card-title" x-text="cat.name"></h5>
      <p x-text="'$' + cat.price"></p>
      <div class="justify-end card-actions">
        <button @click="addCart(cat.id)" class="btn btn-primary">
          <i class="fas fa-cat"></i> 認養
        </button>
      </div>
    </div>
  </div>
</template>
```

### 6. Alpine.js 事件系統

#### 常用事件語法
```html
@click="method()"        <!-- 點擊事件 -->
@input="method()"        <!-- 輸入事件（即時觸發） -->
@change="method()"       <!-- 變更事件（失焦觸發） -->
@submit="method()"       <!-- 表單提交 -->
@keydown="method()"      <!-- 按鍵按下 -->
@blur="method()"         <!-- 失去焦點 -->
@focus="method()"        <!-- 獲得焦點 -->
```

#### @input vs @change 差異
- `@input` - 每次輸入字符都觸發，適合即時驗證
- `@change` - 失去焦點時才觸發，適合完成後處理

#### 等同於原生 JavaScript
```html
<!-- Alpine.js 語法 -->
<input @input="validateQuantity(item)">

<!-- 原生 JavaScript 等同 -->
<input oninput="validateQuantity(item)">
```

### 7. 數據流向

1. 點擊認養 → addCart() → 更新 cart 陣列 → saveCart() → localStorage
2. 修改數量 → @input 觸發 → validateQuantity() → 驗證修正 → saveCart()
3. x-model 雙向綁定 → 自動更新 cart 陣列和UI
4. 計算總價 → totalPrice() → 遍歷 cart 陣列 → 返回格式化金額
5. 頁面刷新 → 從 localStorage 讀取 → 恢復 cart 狀態

## 完整功能清單

- 點擊認養加入購物車
- 動態顯示認養清單
- 數量雙向綁定修改
- 數量輸入驗證（防止負數、0、非數字）
- 自動計算小計和總價
- 刪除單個項目
- 清空整個購物車（含確認對話框）
- localStorage 持久化存儲
- 動態貓咪卡片循環渲染

## 重要心得

1. Alpine.js 的核心是響應式 - 狀態改變時UI自動更新
2. 陣列索引檢查很重要 - 索引0不等於false
3. localStorage 需要序列化 - 物件必須轉成字串存儲
4. 雙向綁定很強大 - x-model 讓數據同步變得簡單
5. 模板循環消除重複 - x-for 讓代碼更乾淨
6. 事件驗證提升用戶體驗 - @input 即時驗證防止錯誤輸入
7. 數據與視圖分離 - JSON 檔案管理資料，模板負責顯示
8. NaN 檢查很重要 - isNaN() 防止非數字運算錯誤
